--// Heroes: Online World GUI Script with Key System and Features
if not game:IsLoaded() then game.Loaded:Wait() end

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer

-- Full list of character names (from your provided data)
local charactersList = {
  "_exempt", "Character", "Pulse", "Azula", "PersonalShield", "SummonShield", "FateClone",
  "FateClone2", "SandClone", "HumanTorch", "SkeletonSypha2", "Clone1", "Clone2", "LokiClone",
  "LokiCloneOld", "Goblin", "PalaceGoblin", "DEMON", "MomWandaX", "MantisX", "NPCRaven",
  "SabrinaRaven", "DemonGoat", "JohnnyFireRaven", "SylvieClone", "Syp", "Victim",
  "RigAbsorb", "AgathaHarkness", "AgathaHarknessBad", "AgathaHarknessWW", "AgathaHarknessYouth",
  "AgathaLight", "AgathaLightCivil", "AgathaLightSecond", "Ajak", "AjakArianna", "ArcherSkeleton",
  "AtomEve", "AtomEveWardrobe", "AtomEveXmas", "Bella", "BlackPanther", "BlackWidow",
  "BlackWidowGreen", "BlackWidowRed", "BlackWidowYellow", "Bloom", "BlueMarvel", "Bonnie",
  "BonnieCheerleader", "BumbleBee", "BumbleBey", "BumbleWasp", "ChildKlarion", "Cyborg",
  "DanSpooky", "DarkBloom", "DarkJosie", "DarkPhoenix", "DarkPhoenixArmor", "DarkPhoenixMaleficent",
  "DarkPhoenixRage", "DarkPhoenixXMen", "DarkPhoenixXmas", "DrFate", "DrFateZat", "DragonFairy",
  "Dust", "Eleven", "ElevenCarrie", "EmmaFrost", "EmmaFrostIceQueen", "EmmaFrostLore",
  "FirePrincess", "GwenBen10", "GwenProm", "GwenPromAmoria", "HarryWizard", "Hera",
  "Hermoi", "HumanTorchFuture", "HumanTorchZuko", "IceWitch", "IceWitchEsdeath", "Ikaris",
  "InvisibleWoman", "InvisibleWomanBride", "InvisibleWomanFuture", "InvisibleWomanViolet", "InvisibleWomanXmas",
  "IronMan", "IronManSuperior", "JavelinSkeleton", "JohnLantern", "Katara", "KingBlackPanther",
  "KingOfHalloween", "Klarion", "ZatannaXmas", "Loki", "LokiSkinVariant", "LokiVday",
  "LokiXmas", "MadelynePryor", "Magik", "MagikDevil", "MagikXMen", "Magneto", "MagnetoY2K",
  "MaleficentAscended", "Mantis", "Mera", "MoMFortuneTeller", "MomWanda", "MomWandaCorrupted",
  "MomWandaJennifer", "MomWandaProdigy", "Musa", "NatureFairy", "PercyJackson", "Player067",
  "Solaris", "Polaris", "PolarisTheGifted", "PolarisVday", "Powergirl", "PromRaven", "Psylocke",
  "PsylockeOld", "Raven", "RavenWardrobe", "RavenWardrobeY2K", "RobotDoll", "Roman",
  "Sabrina", "SabrinaGoldenRuler", "SabrinaJohnnyFire", "ScarletFortuneTeller", "ScarletUltron",
  "ScarletWitch", "ScarletWitchValentine", "ScarletWitchVariant", "ScarletWitchVariantUltron",
  "ScarletWitchVariantValentine", "ScarletWitchXmas", "ScarletWitchZombie", "ScarletWitchZombieVariant",
  "Shiklah", "Spidergwen", "Spiderman", "SpidermanXmas", "SquidManager", "SquidSoldier",
  "SquidWorker", "StarSapphire", "Stella", "StellaEnchantix", "Storm", "StormBride",
  "StormChristmas", "StormValentine", "StormXSkin", "Stormy", "StormyNickiX", "SunnyGwen",
  "Supergirl", "SupergirlBreached", "SupergirlUpgraded", "SupergirlXmas", "Superman",
  "SupermanBizarre", "SupermanInjustice", "SylvieX", "Sypha", "SyphaNomad", "SyphaXmas",
  "Tevin", "Thor", "ThorJaneFoster", "ThorZeus", "TrinityY2KBlue", "TrinityY2KGrey", "TrinityY2KPink",
  "Ultron", "VariantFortuneTeller", "Venom", "WandaVision", "WandaVisionWardrobe",
  "WandaVisionWardrobeVariant", "WaterFairy", "WaterMaster", "Wednesday", "WednesdayLore",
  "WednesdayMadison", "WhiteRaven", "Y2KMadison", "ZatProm", "Zatanna", "ZatannaCharm",
  "ZatannaGlinda", "ZatannaJustice", "LaurenStrucker", "DustCleopatra", "DustAnubis",
  "SabrinaDaenerys", "DrStrange", "DrStrangeAncient", "Evanora", "ZatannaZeZe", "PoisonIvy",
  "TechFairy", "SolarisY2K", "MotherNature", "PsylockeSakura", "AgathaCasual", "Goblin",
  "MCU", "RavenRage", "LimboShiklahMorph", "AgathaMother", "1PlaceDummy", "2PlaceDummy",
  "3PlaceDummy", "vmqzxo", "gertrudeisbest_123", "Lordgamer8452", "pamidorkka", "ell1vxs",
  "CataclysmAgnes", "Dark166076", "BlueOcean_Clouds", "l_albo1", "MienoTC", "hiddeninthesilence",
  "darioxvs"
}

-- RemoteEvent used to unlock characters
local unlockEvent = ReplicatedStorage:WaitForChild("metaRemoteEvent")

-- Function to safely get leaderstats 'Coins'
local function getCoinsStat()
    local stats = localPlayer:FindFirstChild("leaderstats")
    if stats then
        local coins = stats:FindFirstChild("Coins")
        if coins then return coins end
    end
    return nil
end

-- Function to get humanoid of player character (for invincibility)
local function getHumanoid()
    local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    return character:FindFirstChildOfClass("Humanoid")
end

-- // Create main GUI but keep it hidden until key accepted
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "HeroesOnlineWorldGUI"
mainGui.Enabled = false

local mainFrame = Instance.new("Frame", mainGui)
mainFrame.Size = UDim2.new(0, 350, 0, 250)
mainFrame.Position = UDim2.new(0.5, -175, 0.5, -125)
mainFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true

-- Title bar
local titleBar = Instance.new("Frame", mainFrame)
titleBar.Size = UDim2.new(1,0,0,30)
titleBar.BackgroundColor3 = Color3.fromRGB(25,25,25)

local titleLabel = Instance.new("TextLabel", titleBar)
titleLabel.Text = "Heroes: Online World | Script GUI"
titleLabel.TextColor3 = Color3.new(1,1,1)
titleLabel.BackgroundTransparency = 1
titleLabel.Size = UDim2.new(0.8,0,1,0)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 18
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Position = UDim2.new(0.05,0,0,0)

-- Minimize button
local minimizeBtn = Instance.new("TextButton", titleBar)
minimizeBtn.Text = "-"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.Size = UDim2.new(0, 30, 1, 0)
minimizeBtn.Position = UDim2.new(0.85, 0, 0, 0)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
minimizeBtn.TextColor3 = Color3.new(1, 1, 1)

local closeBtn = Instance.new("TextButton", titleBar)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Size = UDim2.new(0, 30, 1, 0)
closeBtn.Position = UDim2.new(0.9, 0, 0, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
closeBtn.TextColor3 = Color3.new(1, 1, 1)

local buttonsFrame = Instance.new("Frame", mainFrame)
buttonsFrame.Size = UDim2.new(1, 0, 1, -30)
buttonsFrame.Position = UDim2.new(0, 0, 0, 30)
buttonsFrame.BackgroundTransparency = 1

-- Create Buttons for Features
local function createButton(name, posY)
    local btn = Instance.new("TextButton", buttonsFrame)
    btn.Size = UDim2.new(0.8, 0, 0, 40)
    btn.Position = UDim2.new(0.1, 0, 0, posY)
    btn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = name
    return btn
end

local invincibleBtn = createButton("Toggle Invincibility", 10)
local infiniteCoinsBtn = createButton("Add 1000 Coins", 60)
local unlockAllBtn = createButton("Unlock All Characters", 110)

-- States
local invincibleEnabled = false
local humanoid = getHumanoid()

-- Invincibility toggle function
local function toggleInvincibility()
    invincibleEnabled = not invincibleEnabled
    if not humanoid or humanoid.Health <= 0 then
        humanoid = getHumanoid()
    end
    if invincibleEnabled and humanoid then
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
    elseif humanoid then
        humanoid.MaxHealth = 100
        humanoid.Health = 100
    end
    invincibleBtn.Text = "Toggle Invincibility: " .. (invincibleEnabled and "ON" or "OFF")
end

-- Infinite Coins function
local function addCoins()
    local coins = getCoinsStat()
    if coins then
        coins.Value = coins.Value + 1000
    end
end

-- Unlock All Characters function
local function unlockAllCharacters()
    for _, charName in ipairs(charactersList) do
        -- Fire server event to unlock character
        pcall(function()
            unlockEvent:FireServer(charName)
        end)
    end
end

-- Connect buttons
invincibleBtn.MouseButton1Click:Connect(toggleInvincibility)
infiniteCoinsBtn.MouseButton1Click:Connect(addCoins)
unlockAllBtn.MouseButton1Click:Connect(unlockAllCharacters)

-- Minimize toggle
local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    buttonsFrame.Visible = not minimized
    if minimized then
        mainFrame.Size = UDim2.new(0, 350, 0, 30)
    else
        mainFrame.Size = UDim2.new(0, 350, 0, 250)
    end
end)

-- Close GUI
closeBtn.MouseButton1Click:Connect(function()
    mainGui.Enabled = false
end)

--// Key system GUI (shown at start)

local keyGui = Instance.new("ScreenGui", game.CoreGui)
keyGui.Name = "KeySystem_HOW"

local keyFrame = Instance.new("Frame", keyGui)
keyFrame.Size = UDim2.new(0, 280, 0, 150)
keyFrame.Position = UDim2.new(0.5, -140, 0.5, -75)
keyFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
keyFrame.BorderSizePixel = 0
keyFrame.Active = true
keyFrame.Draggable = true

local keyTitle = Instance.new("TextLabel", keyFrame)
keyTitle.Size = UDim2.new(1, 0, 0, 40)
keyTitle.BackgroundTransparency = 1
keyTitle.Text = "Enter Key to Access"
keyTitle.TextColor3 = Color3.new(1, 1, 1)
keyTitle.Font = Enum.Font.GothamBold
keyTitle.TextSize = 20

local keyBox = Instance.new("TextBox", keyFrame)
keyBox.Position = UDim2.new(0.1, 0, 0.4, 0)
keyBox.Size = UDim2.new(0.8, 0, 0, 30)
keyBox.PlaceholderText = "Type key here"
keyBox.Text = ""
keyBox.Font = Enum.Font.Gotham
keyBox.TextSize = 18
keyBox.TextColor3 = Color3.new(1,1,1)
keyBox.BackgroundColor3 = Color3.fromRGB(60,60,60)
keyBox.BorderSizePixel = 0

local submitBtn = Instance.new("TextButton", keyFrame)
submitBtn.Position = UDim2.new(0.3, 0, 0.75, 0)
submitBtn.Size = UDim2.new(0.4, 0, 0, 35)
submitBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
submitBtn.TextColor3 = Color3.new(1, 1, 1)
submitBtn.Font = Enum.Font.GothamBold
submitBtn.TextSize = 18
submitBtn.Text = "Submit"

local function checkKey(input)
    if input:lower() == "fenton" then
        keyGui:Destroy()
        mainGui.Enabled = true
    else
        keyBox.Text = ""
        keyBox.PlaceholderText = "Wrong Key! Try again."
    end
end

submitBtn.MouseButton1Click:Connect(function()
    checkKey(keyBox.Text)
end)

keyBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        checkKey(keyBox.Text)
    end
end)
